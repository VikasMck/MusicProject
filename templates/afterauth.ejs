<!DOCTYPE html>
<html lang="en">
<head>
    <title>Eric & Vikas Music</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

</head>
<body>

<!-- navbar -->
<div class="w3-top">
    <div class="w3-bar w3-black w3-card">
        <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
        <a href="#" class="w3-bar-item w3-button w3-padding-large">HOME</a>
        <a href="#convernav" class="w3-bar-item w3-button w3-padding-large w3-hide-small">CONVERT</a>
        <a href="#songnav" class="w3-bar-item w3-button w3-padding-large w3-hide-small">SONGS</a>
        <a href="#contact" class="w3-bar-item w3-button w3-padding-large w3-hide-small">CONTACT</a>
        <div class="w3-dropdown-hover w3-hide-small">
            <button class="w3-padding-large w3-button" title="More">MORE <i class="fa fa-caret-down"></i></button>
            <div class="w3-dropdown-content w3-bar-block w3-card-4">
                <a href="#" class="w3-bar-item w3-button">Merchandise</a>
                <a href="#" class="w3-bar-item w3-button">Extras</a>
                <a href="#" class="w3-bar-item w3-button">Media</a>
            </div>
        </div>
        <div class="w3-dropdown-hover w3-hide-small w3-right">
            <button class="w3-padding-large w3-button" title="Login/Register">
                HELLO <%= username.toUpperCase() %>! <i class="fa fa-caret-down"></i>
            </button>
            <div class="w3-dropdown-content w3-bar-block w3-card-4">
                <a href="/useraccount" class="w3-bar-item w3-button" onclick="showLoginModal()">Profile</a>
                <a href="/logout" class="w3-bar-item w3-button" onclick="showRegisterModal()">Logout</a>
                <a href="/read" class="w3-bar-item w3-button" id="viewAccountsLink" style="display: none;" onclick="showRegisterModal()">View accounts</a>
            </div>
        </div>
    </div>
</div>

<!-- if the screen is smaller than nav bar, a burger icon pops up showing the core items -->
<div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
    <a href="#convernav" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">CONVERT</a>
    <a href="#tour" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">SONGS</a>
    <a href="#contact" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">CONTACT</a>
    <a href="/useraccount" class="w3-bar-item w3-button w3-padding-large" onclick="showLoginModal()">PROFILE</a>
    <a href="/logout" class="w3-bar-item w3-button w3-padding-large" onclick="showRegisterModal()">LOGOUT</a>
</div>

<!-- big div -->
<div class="w3-content" style="max-width:2000px;margin-top:46px">
    <!-- main image with the welcome text -->
    <div class="mySlides w3-display-container w3-center">
        <div style="position: relative;">
            <img src="/Images/header-grey.jpeg" style="width:100%; opacity: 0.9;">
        </div>
    </div>

    <!-- creating playlists -->
    <div style="background-image: url('/Images/convert-part-disk.jpeg'); background-size: cover; background-position: center; background-repeat: no-repeat;">
        <div class="w3-container w3-content w3-center w3-padding-64" id="convernav">
            <h2 class="w3-wide w3-text-white">CONVERT</h2>
            <p class="w3-opacity w3-text-white"><i>We love music</i></p>
            <p class="w3-justify w3-text-white">Using this website you are able to enjoy music your way without any hassles! Convert your Spotify playlist into a YouTube one here!</p>
            <div>
                <img src="/Images/youtube_music_spotify_convert.webp" alt="Convert" style="width:50%; border-radius: 30px">
                <div class="w3-container">
                    <p class="w3-text-white w3-padding-16">Use your Spotify playlist link and get a YouTube playlist made into your account!</p>
                    <button class="w3-button w3-black w3-margin-bottom" onclick="document.getElementById('ticketModal').style.display='block'" style="padding: 25px 35px; box-shadow: 0 0 30px 10px rgb(101, 100, 100);">CONVERT</button>
                </div>
            </div>
        </div>
    </div>

    <!-- all song part-->
    <div class="w3-black" id="songnav">
        <div class="w3-container w3-content w3-padding-64" style="max-width:1300px; margin: 0 auto;">
            <h2 class="w3-wide w3-center">Which song in your playlist do you want to look up?</h2>
            <p class="w3-opacity w3-center"><i>Do it here after converting the playlist! </i></p><br>
            <div class="w3-container w3-margin w3-round-large w3-row-padding" style="background: none; display: flex; justify-content: center; align-items: center;">
                <div class="w3-col s12 m4" style="margin-bottom: 20px;">
                    <label for="songName" class="w3-text-white" style="display: block; margin-bottom: 5px;">Song Name:</label>
                    <input type="text" id="songName" name="songName" placeholder=" " class="w3-input" style="border: none; border-bottom: 1px solid white; background: none; color: white;">
                </div>
                <div class="w3-col s12 m4" style="margin-bottom: 20px;">
                    <label for="artist" class="w3-text-white" style="display: block; margin-bottom: 5px;">Artist:</label>
                    <input type="text" id="artist" name="artist" placeholder=" " class="w3-input" style="border: none; border-bottom: 1px solid white; background: none; color: white;">
                </div>
            </div>            
            
        </div>

        <div id="songList" style="overflow: auto; max-height: 800px; background-image: url('/images/song-part-black.jpeg'); background-size: cover; background-position: center;"></div>

    </div>

    

    <!-- Convert model -->

    <div id="ticketModal" class="w3-modal">
        <div class="w3-modal-content w3-animate-top w3-card-4" style="box-shadow: 0 0 30px 10px rgba(128, 128, 128, 0.8);">
            <header class="w3-container w3-black w3-center w3-padding-32">
                <span onclick="document.getElementById('ticketModal').style.display='none'" class="w3-button w3-black w3-xlarge w3-display-topright">Ã—</span>
                <h2 class="w3-wide"><i class="w3-margin-right"></i>Convert Your Playlist Here!</h2>
            </header>
            <div class="w3-container w3-grey">
                <p><label><i class="fa fa-search"></i> Add your Spotify link here!</label></p>
                <input class="w3-input"
                type="text" id="playlistLink"
                placeholder="https://open.spotify.com/playlist/......."
                style="border: none; border-bottom: 1px solid #000; outline: none; background: transparent; color: #000;">

                <p><label><i class="fa fa-truck"></i> Name your YouTube playlist</label></p>
                <input class="w3-input"
                type="text" id="playlistName"
                placeholder="Name...."
                style="border: none; border-bottom: 1px solid #000; outline: none; background: transparent; color: #000;">

                <button id="convertButton" class="w3-button w3-block w3-black w3-padding-16 w3-section w3-right" onclick="convertAndExecute()">Done<i class="fa fa-check"></i></button>
            </div>
        </div>
    </div>
    
    

    <!--  contact section just because looks nice -->
    <div style="background: linear-gradient(90deg, rgba(29,29,29,1) 0%, rgba(67,67,67,1) 37%, rgba(61,61,61,1) 51%, rgba(61,61,61,1) 57%, rgba(59,59,59,1) 62%, rgba(40,40,40,1) 70%, rgba(32,32,32,1) 79%, rgba(30,30,30,1) 89%, rgba(27,27,27,1) 100%);">
        <div class="w3-container w3-content w3-padding-64"  id="contact">
            <h2 class="w3-wide w3-center w3-text-white">CONTACT</h2>
            <div class="w3-row w3-padding-32">
                <div class="w3-col m6 w3-large w3-text-white" style="padding-right: 20px;"> 
                    <i class="fa fa-map-marker" style="width:30px; margin-right: 10px;"></i> Dublin, Ireland<br>
                    <i class="fa fa-phone" style="width:30px; margin-right: 10px;"></i> Phone: 012345678<br>
                    <i class="fa fa-envelope" style="width:30px; margin-right: 10px;"> </i> Email: mail@mail.com<br>
                </div>
                <div class="w3-col m6" style="padding-left: 20px;"> 
                    <form action="" target="_blank" style="padding: 0 16px;"> 
                        <div class="w3-row-padding" style="margin:0 -16px 8px -16px">
                            <div class="w3-half">
                                <input class="w3-input" type="text" placeholder="Name" required name="Name" style="border: none; border-bottom: 1px solid #ffffff; outline: none; background: transparent; color: #ffffff;">
                            </div>
                            <div class="w3-half">
                                <input class="w3-input" type="text" placeholder="Email" required name="Email" style="border: none; border-bottom: 1px solid #ffffff; outline: none; background: transparent; color: #ffffff;">
                            </div>
                        </div>
                        <input class="w3-input" type="text" placeholder="Message" required name="Message" style="border: none; border-bottom: 1px solid #ffffff; outline: none; background: transparent; color: #ffffff;">
                        <button class="w3-button w3-white w3-text-black w3-right" type="submit" style="padding: 10px 20px;">SEND</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div style="background: linear-gradient(90deg, rgba(29,29,29,1) 0%, rgba(67,67,67,1) 37%, rgba(61,61,61,1) 51%, rgba(61,61,61,1) 57%, rgba(59,59,59,1) 62%, rgba(40,40,40,1) 70%, rgba(32,32,32,1) 79%, rgba(30,30,30,1) 89%, rgba(27,27,27,1) 100%);">
        <footer class="w3-container w3-padding-64 w3-center w3-xlarge">
            <p class="w3-medium w3-text-white">By Vikas and Eric</p>
        </footer>
    </div>

    <!-- end of big div -->
</div>

<script src="https://apis.google.com/js/api.js"></script>

<script>
    async function convertAndExecute() {
    const playlistLink = document.getElementById('playlistLink').value;
    const playlistName = document.getElementById('playlistName').value;

    //get playlist id from link
    const playlistIdMatch = playlistLink.match(/playlist\/(\w+)/);
    const spPlaylistId = playlistIdMatch ? playlistIdMatch[1] : null;

    if (!spPlaylistId) {
    alert('Invalid Spotify Playlist Link');
    return;
    }

    try {
    //make a request
    const response = await fetch('/convert', {
        method: 'POST',
        headers: {
        'Content-Type': 'application/json',
        },
        body: JSON.stringify({ spPlaylistId }),
    });

    if (!response.ok) {
        throw new Error(`Server returned status: ${response.status}`);
    }

    const data = await response.json();
    const videoIds = data.videoIds;

    await authenticate();
    await loadClient();
    const playlistId = await execute(playlistName, videoIds);

    console.log('Video IDs:', videoIds);
    } catch (error) {
    console.error('Error:', error);
    alert('An error occurred. Please check the console for details.');
    }
    setTimeout(function() {
    location.reload();
    }, 800);

}


    document.getElementById('convertButton').addEventListener('click', convertAndExecute);

    function authenticate() {
    return gapi.auth2.getAuthInstance()
        .signIn({ scope: "https://www.googleapis.com/auth/youtube.force-ssl" });
    }

    function loadClient() {
    gapi.client.setApiKey("AIzaSyAvgCn9p__sDlixaKr2Yu2RTLsTGVHyZBg");
    return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest");
    }

    async function execute(title, videoIds) {
    try {
        const playlistResponse = await gapi.client.youtube.playlists.insert({
        "part": ["snippet"],
        "resource": {
            "snippet": {
            "title": title
            }
        }
        });

        const playlistId = playlistResponse.result.id;
        console.log(`Playlist created with ID: ${playlistId}`);

        for (const videoId of videoIds) {
        const playlistItemResponse = await gapi.client.youtube.playlistItems.insert({
            "part": ["snippet"],
            "resource": {
            "snippet": {
                "playlistId": playlistId,
                "position": 0,
                "resourceId": {
                "kind": "youtube#video",
                "videoId": videoId
                }
            }
            }
        });

        console.log(`Video ${videoId} added to the playlist`);
        // Handle the results here if needed
        console.log("Response", playlistItemResponse);
        }

        return playlistId; // Return the playlist ID if needed
    } catch (err) {
        console.error("Execute error", err);
        throw err; // Propagate the error for better error handling
    }
    }

    gapi.load("client:auth2", function () {
    gapi.auth2.init({
        client_id: "532965186327-qcbbpaehlsc3m7h6ll5ephqiqs8lh7vu.apps.googleusercontent.com",
        plugin_name: "name",
    });
    });

    //inline js because of this username value
    var username = '<%= username %>'; 

    if (username === "admin") {
        document.getElementById("viewAccountsLink").style.display = "block";
    } else {
        document.getElementById("viewAccountsLink").style.display = "none";
    }


    $(document).ready(function () {
        function performSearch() {
            var songName = $('#songName').val();
            var artist = $('#artist').val();

            if (!songName && !artist) {
                //use ajax to request songs
                $.ajax({
                    type: 'GET',
                    url: '/all-songs', 
                    success: function (data) {
                        $('#songList').html(data);
                    },
                    error: function (error) {
                        console.error('Error retrieving all songs:', error);
                    }
                });                   
            }

            $.ajax({
                type: 'GET',
                url: '/search', 
                data: { songName: songName, artist: artist },
                success: function (data) {
                    $('#songList').html(data);
                },
                error: function (error) {
                    console.error('Error performing search:', error);
                }
            });
        }

        $('#songName, #artist').on('input', function () {
            performSearch();
        });

        performSearch();
    });

</script>



<script src="/js/scripts.js"> </script>

</body>
</html>
